<!DOCTYPE html>
<html lang="ko">

<head>
	@@include('@@webRoot/html/_include/app-head.html',{
	"title": "Last Depth | 1st Depth"
	})
</head>

<body>
	@@include('@@webRoot/html/_include/app-a11y.html')
	<div class="app">
		<!-- 수정 : app-header (Type 구분) //-->
        @@include('@@webRoot/html/_include/app-integrated-header.html',{
            'pageTit':'페이지 타이틀',
            'type':''
        })
        <!-- // 수정 : app-header (Type 구분)-->
		<!-- app-container //-->
		<div class="app-container">
			<!-- app-lnb //-->
			<div class="app-lnb">
				<div class="tab swiper-container">
					<ul class="swiper-wrapper">
						<li class="swiper-slide"><a href="javscript:;">선물</a></li><!-- 수정 : 2021.06.25 -->
						<li class="swiper-slide is-active"><a href="javscript:;">실시간 이벤트</a></li>
						<!-- 수정 : 2021.06.25 -->
						<li class="swiper-slide"><a href="javscript:;">친구추천</a></li><!-- 수정 : 2021.06.25 -->
					</ul>
				</div>
			</div>
			<!-- //app-lnb -->

			<!-- app-content // -->
			<main class="app-content">
				<section class="kb-sec event-area event-scratch">
					<h1>최초 계좌추가<br>스크래치 이벤트</h1>
					<div class="scratch">
						<div class="scratch-area" id="js-container">
							<div class="canvas" id="canvas">
								<div class="msg">복권을 긁어보세요.</div>
								<canvas id="js-canvas"></canvas>
							</div>
							<div class="result">스타벅스 아메리카노 1매</div>
						</div>
						<ul>
							<li>
								<div class="content" data-img-src="img-voucher.png">
									<strong class="tit">신세계이마트 상품권</strong>
									<p><span class="num">30,000</span>원</p>
								</div>
							</li>
							<li>
								<div class="content" data-img-src="img-pointre.png">
									<strong class="tit">KB 포인트리</strong>
									<p><span class="num">500</span>P</p>
								</div>
							</li>
							<li>
								<div class="content" data-img-src="img-coffee.png">
									<strong class="tit">스타벅스 디저트 세트</strong>
									<p><span class="num">1</span>매</p>
								</div>
							</li>
							<li>
								<div class="content" data-img-src="img-pointre.png">
									<strong class="tit">KB 포인트리</strong>
									<p><span class="num">1000</span>P</p>
								</div>
							</li>
						</ul>
					</div>
				</section>

				<section class="kb-sec">
					<dl class="event-desc">
						<dt>기간</dt>
						<dd>2021.10.04(월) ~ 2021.10.29(금)</dd>
						<dt>대상</dt>
						<dd>
							KB마이데이터 최초동의 고객 중 통합인증 및 전체동의 완료 고객
						</dd>
						<dt>참여방법</dt>
						<dd>
							- 미완료 고객<br>
							① 상단 ‘동의하러 가기’ 버튼 클릭<br>
							② 통합인증 및 전체동의 완료<br>
							③ 즉석룰렛 스티커 클릭<br>
							④ 룰렛 이벤트의 ‘START’ 버튼 클릭<br>
							⑤ 실시간 당첨 리워드 확인가능<br>
							<br>
							- 완료 고객<br>
							① 마이데이터 선물함 메뉴의 실시간 이벤트에서<br>
							‘룰렛이벤트 배너’ 클릭<br>
							② 룰렛 이벤트의 ‘START’ 버튼 클릭<br>
							③ 실시간 당첨 리워드 확인가능
						</dd>
						<dt>당첨자 발표</dt>
						<dd>
							100% 경품 당첨 실시간 확인 가능
						</dd>
						<dt>경품</dt>
						<dd>
							신세계이마트 상품권 3만원 (1,000명)<br>
							스타벅스 부드러운 디저트 세트 1매 (5,000명)<br>
							스타벅스 아이스 아메리카노 Tall 1매 (10,000명)<br>
							포인트리 500P (420,000명)
						</dd>
					</dl>
					<dl class="event-caution">
						<dt>유의사항</dt>
						<dd>
							- 본 이벤트는 KB국민은행의 이벤트로 사정에 따라 변경 또는 중단될 수 있습니다.<br>
							- 참여고객 대상 지급되는 경품은 참여 즉시 지급되며 마이데이터 선물함 &gt; 선물에서 확인 가능합니다.<br>
							- 기타 자세한 이벤트 내용은 KB마이데이터 담당자 (02-2073-0000, 평일 9~18시 / 주말 및 공휴일 휴무)에게 문의바랍니다.<br>
							<br>
							본 광고물에 대한 유효기간 2021.10.31까지 준법감시인 심의필 제2021-0000호(2021.09.27)
						</dd>
					</dl>
				</section>

			</main>
			<!-- // app-content -->

		</div>
		<!-- // app-container -->

		<!-- Layer (fullpage popup, modal, bottom sheet) // -->
		<div class="layered">
			@@include('@@webRoot/html/menu/layered/mys_mn_06_01_04_p01.html')
		</div>
		<!-- // Layer (fullpage popup, modal, bottom sheet) -->

	</div>
	<!-- Script -->
	@@include('@@webRoot/html/_include/common-js.html')
	<!-- Add Library (this page only)-->
	<script src="@@webRoot/static/js/ui.js"></script>
	<!-- Add Script -->

	<script>
		(function () {

			'use strict';

			var isDrawing, lastPoint;
			var canvas = document.getElementById('js-canvas');
			var canvasWrapper = document.getElementById('canvas');
			var canvasWidth = Math.ceil(canvasWrapper.offsetWidth) + 2;
			var canvasHeight = Math.ceil(canvasWrapper.offsetHeight) + 2;
			var ctx = canvas.getContext('2d');
			var imageObj = new Image();
			var brush = new Image();			
			
			imageObj.src ="@@webRoot/static/images/event/scratch.png";
			imageObj.onload = function () {	
				var imgWidth = imageObj.naturalWidth;
				var imgHeight = imageObj.naturalHeight;				
				var screenWidth  = canvasWidth;
				var screenHeight = canvasHeight;				
				
				var scaleX = 1;
				if (imgWidth > screenWidth)
					scaleX = screenWidth/imgWidth;
				
				var scaleY = 1;
				if (imgHeight > screenHeight)
					scaleY = screenHeight/imgHeight;
				var scale = scaleY;
				if(scaleX < scaleY)
					scale = scaleX;
				if(scale < 1){
					imgHeight = imgHeight*scale;
					imgWidth = imgWidth*scale;          
				}

				ctx.canvas.height = imgHeight;
				ctx.canvas.width = imgWidth;
				
				ctx.drawImage(imageObj, 0, 0, imageObj.naturalWidth, imageObj.naturalHeight, 0,0, imgWidth, imgHeight);
				// Show the form when Image is loaded.
				document.querySelectorAll('.scratch-area')[0].style.visibility = 'visible';				
			};
			
			brush.src = '@@webRoot/static/images/event/scarchimagetrans.png';

			canvas.addEventListener('mousedown', handleMouseDown, false);
			canvas.addEventListener('touchstart', handleMouseDown, false);
			canvas.addEventListener('mousemove', handleMouseMove, false);
			canvas.addEventListener('touchmove', handleMouseMove, false);
			canvas.addEventListener('mouseup', handleMouseUp, false);
			canvas.addEventListener('touchend', handleMouseUp, false);

			function distanceBetween(point1, point2) {
				return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));
			}

			function angleBetween(point1, point2) {
				return Math.atan2(point2.x - point1.x, point2.y - point1.y);
			}

			// Only test every `stride` pixel. `stride`x faster,
			// but might lead to inaccuracy
			function getFilledInPixels(stride) {
				if (!stride || stride < 1) {
					stride = 1;
				}

				var pixels = ctx.getImageData(0, 0, canvasWidth, canvasHeight),
					pdata = pixels.data,
					l = pdata.length,
					total = (l / stride),
					count = 0;

				// Iterate over all pixels
				for (var i = count = 0; i < l; i += stride) {
					if (parseInt(pdata[i]) === 0) {
						count++;
					}
				}

				return Math.round((count / total) * 100);
			}

			function getMouse(e, canvas) {
				var offsetX = 0,
					offsetY = 0,
					mx, my;

				if (canvas.offsetParent !== undefined) {
					do {
						offsetX += canvas.offsetLeft;
						offsetY += canvas.offsetTop;
					} while ((canvas = canvas.offsetParent));
				}

				mx = (e.pageX || e.touches[0].clientX) - offsetX;
				my = (e.pageY || e.touches[0].clientY) - offsetY;

				return {
					x: mx,
					y: my
				};
			}

			function handlePercentage(filledInPixels) {
				filledInPixels = filledInPixels || 0;
				//console.log(filledInPixels + '%');
				if (filledInPixels > 0) {
					$('.canvas').find('.msg').hide();
				}
				if (filledInPixels > 75) {
					// action
					$('.canvas').hide();
					if (!$('.canvas').hasClass('activated')) {
						gfn_layered.open('bsRewardDetail');
						$('.canvas').addClass('activated');
					}
				}
			}

			function handleMouseDown(e) {
				isDrawing = true;
				lastPoint = getMouse(e, canvas);
			}

			function handleMouseMove(e) {
				if (!isDrawing) {
					return;
				}

				e.preventDefault();

				var currentPoint = getMouse(e, canvas),
					dist = distanceBetween(lastPoint, currentPoint),
					angle = angleBetween(lastPoint, currentPoint),
					x, y;

				for (var i = 0; i < dist; i++) {
					x = lastPoint.x + (Math.sin(angle) * i) - 25;
					y = lastPoint.y + (Math.cos(angle) * i) - 25;
					ctx.globalCompositeOperation = 'destination-out';
					ctx.drawImage(brush, x, y);
				}

				lastPoint = currentPoint;
				handlePercentage(getFilledInPixels(32));
			}

			function handleMouseUp(e) {
				isDrawing = false;
			}

		})();
	</script>

</body>

</html>